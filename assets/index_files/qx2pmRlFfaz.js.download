if (self.CavalryLogger) { CavalryLogger.start_js(["HdeZt"]); }

__d("CometFeedStoryOptimisticMediaAttachmentSection_story.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CometFeedStoryOptimisticMediaAttachmentSection_story",selections:[{kind:"ClientExtension",selections:[{alias:null,args:null,concreteType:"OptimisticMediaAttachmentData",kind:"LinkedField",name:"optimistic_media_attachments",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"entID",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"objectURL",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"useCDNPreview",storageKey:null}],storageKey:null}]}],type:"Story",abstractKey:null};e.exports=a}),null);
__d("makeMediaAttachmentReadyForPreview",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a.state){case"NEW":case"CLIENT_PROCESSING":switch(a.fileType){case"PHOTO":return{data:a.data,file:a.file,fileObjectURL:a.fileObjectURL,fileType:"PHOTO",hasSphericalMetadata:a.hasSphericalMetadata,state:"CLIENT_PROCESSING",useCDNPreview:a.useCDNPreview};case"VIDEO":return{data:a.data,file:a.file,fileObjectURL:a.fileObjectURL,fileType:"VIDEO",state:"CLIENT_PROCESSING",useCDNPreview:a.useCDNPreview};default:return a}case"PREEXISTING":return a;case"UPLOADED":switch(a.fileType){case"PHOTO":return{data:a.data,entID:a.data.id,file:a.file,fileObjectURL:a.fileObjectURL,fileType:"PHOTO",hasSphericalMetadata:a.hasSphericalMetadata,height:a.height,state:"UPLOADED",useCDNPreview:a.useCDNPreview,width:a.width};case"VIDEO":return{data:a.data,entID:a.data.id,file:a.file,fileObjectURL:a.fileObjectURL,fileType:"VIDEO",height:a.height,state:"UPLOADED",useCDNPreview:a.useCDNPreview,width:a.width};default:return a}case"FAILED":switch(a.fileType){case"PHOTO":return{data:a.data,error:a.error,file:a.file,fileObjectURL:a.fileObjectURL,fileType:"PHOTO",height:a.height,state:"FAILED",useCDNPreview:!0,width:a.width};case"VIDEO":return{data:a.data,error:a.error,file:a.file,fileObjectURL:a.fileObjectURL,fileType:"VIDEO",height:a.height,state:"FAILED",useCDNPreview:!0,width:a.width};default:return a}default:var b;switch(a.state){case"QUEUED":b=0;break;case"UPLOADING":b=a.percentComplete;break;case"UPLOADED":b=1;break;default:b=void 0;break}switch(a.fileType){case"PHOTO":return{fileMimeType:a.file.type,fileName:a.file.name,fileObjectURL:a.fileObjectURL,fileType:a.fileType,hasSphericalMetadata:a.hasSphericalMetadata,height:a.height,percentComplete:b,state:"OPTIMISTIC_UPLOADED",uploadID:a.file.uploadID,useCDNPreview:a.useCDNPreview,width:a.width};case"VIDEO":return{fileMimeType:a.file.type,fileName:a.file.name,fileObjectURL:a.fileObjectURL,fileType:a.fileType,height:a.height,percentComplete:b,state:"OPTIMISTIC_UPLOADED",uploadID:a.file.uploadID,useCDNPreview:a.useCDNPreview,width:a.width};default:return{fileMimeType:a.file.type,fileName:a.file.name,fileObjectURL:a.fileObjectURL,fileType:a.fileType,percentComplete:b,state:"OPTIMISTIC_UPLOADED",uploadID:a.file.uploadID}}}}e.exports=a}),null);
__d("CometComposerMediaAttachmentArea.react",["requireDeferred","ComposerCometMediaAttachmentCollage.react","React","composerMediaAttachmentReducer","makeMediaAttachmentReadyForPreview","useComposerViewStateDispatcher","useComposerViewStateReducer","withComposerViewStatePart"],(function(a,b,c,d,e,f){"use strict";var g=b("React");c=b("React");var h=c.useEffect;b("requireDeferred")("mediaAttachmentAreaTransform");function a(a){var c=a.disableVideo;c=c===void 0?!1:c;var d=a.mediaAttachments,e=a.mediaUploadLoggingMetadata;a=a.width;b("useComposerViewStateReducer")(b("composerMediaAttachmentReducer"));var f=b("useComposerViewStateDispatcher")();h(function(){return function(){f({type:"REMOVE_ALL_MEDIA_ATTACHMENT_ITEMS"})}},[f]);return d!=null?g.jsx(b("ComposerCometMediaAttachmentCollage.react"),{disableVideoUploads:c,inComposer:!0,mediaAttachments:d.map(function(a){switch(a.state){case"PREEXISTING":return a;default:return a.file&&a.fileType!=="UNKNOWN"?a:null}}).filter(Boolean).map(b("makeMediaAttachmentReadyForPreview")),mediaUploadLoggingMetadata:e,width:a}):null}e.exports=b("withComposerViewStatePart")(a,function(a){return{mediaAttachments:a.mediaAttachments}})}),null);
__d("cometComposerCheckMediaAttachmentsForPhoto3d",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(!a)return;var c=a.reduce(function(a,b){b.state==="UPLOADED"&&b.fileType==="PHOTO"&&a.push(b);return a},[]);if(a.length!==2||c.length!==2)return;a=g(c);c=h(a);if(c==null)return;b({colorImageIds:c.colorImageIds,depthImageIds:c.depthImageIds,placeholderImage:c.placeholderImage,type:"SET_PHOTO3D_CREATION_DATA"});b({attachmentType:"PHOTO3D",type:"ACTIVATE_ATTACHMENT_TYPE"})}function g(a){var b={},c=["jpg","jpeg","png"];a.forEach(function(a){var d=a.file.name;if(!d)return;var e=d.lastIndexOf(".");if(e<0)return;var f=d.split(".").pop().toLowerCase();if(!c.includes(f))return;f=d.substring(0,e).toLowerCase();d=f.split("_");if(d.length>1&&d.pop().toLowerCase()==="depth"){e=d.join("_");e in b||(b[e]={colorImage:null,depthImage:null});b[e].depthImage=a}else f in b||(b[f]={colorImage:null,depthImage:null}),b[f].colorImage=a});return b}function h(a){var b=Object.keys(a).sort();if(b.length===0)return null;var c=[],d=[],e=null;b.forEach(function(b){b=a[b];var f=b.colorImage;b=b.depthImage;if(!f||!b)return null;var g=f.entID;b=b.entID;if(g==null||b==null)return null;e==null&&(e=f);c.push(g);d.push(b)});return c.length===0||c.length!==d.length||e===null?null:{colorImageIds:c,depthImageIds:d,placeholderImage:e}}e.exports=a}),null);
__d("CometFeedStoryOptimisticMediaAttachmentSection.react",["requireDeferred","CometRelay","React","deferredLoadComponent","CometFeedStoryOptimisticMediaAttachmentSection_story.graphql"],(function(a,b,c,d,e,f){"use strict";var g;c=b("CometRelay").createSuspenseFragmentContainer_DEPRECATED;b("CometRelay").graphql;var h=b("React");d=b("React");var i=d.useEffect,j=d.useRef,k=d.useState,l=b("deferredLoadComponent")(b("requireDeferred")("CometFeedStoryOptimisticProgressBar.react")),m=b("deferredLoadComponent")(b("requireDeferred")("ComposerCometMediaAttachmentCollage.react"));function a(a){var b=j(),c=k(0),d=c[0],e=c[1];i(function(){b.current&&e(b.current.offsetWidth)},[]);a=(c=a.story)==null?void 0:c.optimistic_media_attachments;if(a==null)return null;c=a.filter(function(a){return a!=null}).map(function(a){return{entID:(a==null?void 0:a.entID)||void 0,fileName:null,fileObjectURL:(a==null?void 0:a.objectURL)||"",fileType:(a==null?void 0:a.type)||"UNKNOWN",state:"OPTIMISTIC_UPLOADED",uploadID:null,useCDNPreview:(a==null?void 0:a.useCDNPreview)||void 0}});return h.jsxs("div",{ref:b,children:[h.jsx(l,{}),d>0&&h.jsx(m,{mediaAttachments:c,mediaUploadLoggingMetadata:{composerEntrypoint:"feed",source:"optimistic_post"},width:d,withoutUploader:!0})]})}e.exports=c(a,{story:g!==void 0?g:g=b("CometFeedStoryOptimisticMediaAttachmentSection_story.graphql")})}),null);